const os = require('os'); // 引入os模块

module.exports = function(RED) {
    function IpHostnameNode(config) {
        RED.nodes.createNode(this, config);
        var node = this;

        node.on("input", function(msg) {
            try {
                // 获取当前的IP地址
                const interfaces = os.networkInterfaces();
                let ipAddress = null;
                for (let devName in interfaces) {
                    let iface = interfaces[devName];
                    for (let alias of iface) {
                        if (alias.family === 'IPv4' && !alias.internal) {
                            ipAddress = alias.address;
                            break;
                        }
                    }
                    if (ipAddress) {
                        break;
                    }
                }

                // 获取主机名
                const hostname = os.hostname();
                var temp={
                    "ip":ipAddress,
                    "hostname":hostname
                }
                // 将IP地址和主机名添加到msg对象中
                msg.payload=temp;

                // 发送消息
                node.send(msg);
            } catch (error) {
                node.error(error);
            }
        });
    }

    RED.nodes.registerType("IpHostname", IpHostnameNode);
};
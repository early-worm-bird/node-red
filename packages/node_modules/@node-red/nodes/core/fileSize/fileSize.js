const fs = require('fs');

module.exports = function(RED) {
    function fileSizeNode(config) {
        RED.nodes.createNode(this, config);
        var node = this;

        node.on("input", async function(msg, send, done) {
            try {
                const filePath = msg.url; // 使用msg.url作为文件路
                fs.stat(filePath, (err, stats) => {
                    if (err) {
                        // 如果文件不存在或有其他错误，则返回错误信息
                        msg.payload = { error: `无法获取文件大小：${err.message}` };
                        node.send(msg);
                        done();
                    } else {
                        // 如果文件存在，则返回文件大小
                        msg.payload = stats.size;
                        node.send(msg);
                        done();
                    }
                });
            } catch (error) {
                node.error(`处理文件时发生错误: ${error.message}`);
                done(error);
            }
        });
    }

    RED.nodes.registerType("fileSize", fileSizeNode);
};